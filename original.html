<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="origin-trial" content="A9AxgGSwmnfgzzkyJHILUr3H8nJ/3D+57oAsL4DBt4USlng4jZ0weq+fZtHC/Qwwn6gd4QSa5DzT3OBif+kXVA0AAAB4eyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9">
    <meta http-equiv="origin-trial" content="AlK2UR5SkAlj8jjdEc9p3F3xuFYlF6LYjAML3EOqw1g26eCwWPjdmecULvBH5MVPoqKYrOfPhYVL71xAXI1IBQoAAAB8eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiV2ViVmlld1hSZXF1ZXN0ZWRXaXRoRGVwcmVjYXRpb24iLCJleHBpcnkiOjE3NTgwNjcxOTksImlzU3ViZG9tYWluIjp0cnVlfQ==">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap');

      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
        /* Changed background to black for loading screen */
      }

      #loading-screen {
        position: fixed;
        font-family: "Fredoka", Source Sans Pro;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        z-index: 9997;
        /* Make sure it's on top of everything */
      }

      .spinner {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 6px solid transparent;
        border-top-color: #f0f0f0;
        border-bottom-color: #f0f0f0;
        animation: spin 0.8s linear infinite, pulse 1s ease-in-out infinite;
        margin-top: 10px;
        /* Space between spinner and text */
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      /* Additional styles for the game */
      #unity-container {
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
      }

      #unity-loading-bar {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: 20px;
        background: rgba(0, 0, 0, 0.5);
        border: 2px solid #ffffff;
        border-radius: 10px;
        display: block;
      }

      #unity-progress-bar-empty {
        width: 100%;
        height: 100%;
        position: relative;
      }

      #unity-progress-bar-full {
        position: absolute;
        top: 0;
        left: 0;
        width: 0%;
        height: 100%;
        background: #4caf50;
        border-radius: 8px;
        transition: width 0.3s ease;
      }

      #unity-warning {
        position: absolute;
        left: 50%;
        top: 5%;
        transform: translate(-50%);
        background: white;
        padding: 10px;
        display: none;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="loading-screen"> Loading... <div class="spinner"></div>
    </div>
    
    <module>
      <moduleprefs title="Google.com">
        <content type="html">
          <!-- Your existing content remains unchanged -->
          <title>Granny Original</title>
          <meta charset="utf-8">
          <meta name="robots" content="noindex, nofollow">
          <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/TemplateData/style.css">
          <script src="https://s0.2mdn.net/instream/video/client.js" async="" type="text/javascript"></script>
          <script async="" src="https://www.google-analytics.com/analytics.js"></script>
          <script type="text/javascript" id="analytics" async="" src="https://cdn.jsdelivr.net/gh/st39/sdk@main/ga.js"></script>
          <script async="" src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
          <script id="gamemonetize-sdk" src="https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js"></script>
          <script src="https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/sdk.js"></script>
          <script>
            document.addEventListener('keydown', function(event) {
              if (event.key === '\\') {
                window.location.href = './index.html';
              }
            });
          </script>
          <script type="text/javascript">
            window.SDK_OPTIONS = {
              gameId: "jp112o3o4hzgrnc7zaewjkrfk282pul8",
              onEvent: function(a) {
                switch (a.name) {
                  case "SDK_GAME_PAUSE":
                    console.log("Oyun duraklatıldı, ses kapatılıyor...");
                    if (typeof myGameInstance !== 'undefined' && myGameInstance) {
                      myGameInstance.SendMessage('AudioManager', 'MuteAudio');
                    }
                    break;
                  case "SDK_GAME_START":
                    console.log("Reklam bitti, oyun devam ediyor...");
                    if (typeof myGameInstance !== 'undefined' && myGameInstance) {
                      myGameInstance.SendMessage('AudioManager', 'UnmuteAudio');
                    }
                    break;
                  case "SDK_READY":
                    console.log("SDK hazır.");
                    break;
                }
              }
            };
            (function(a, b, c) {
              var d = a.getElementsByTagName(b)[0];
              a.getElementById(c) || (a = a.createElement(b), a.id = c, a.src = "https://cdn.jsdelivr.net/gh/testamalame/sef@main/sedk.js", d.parentNode.insertBefore(a, d));
            })(document, "script", "gamemonetize-sdk");
          </script>
          <div id="unity-container">
            <canvas id="unity-canvas" style="position: absolute; width: 100%; height: 100%; cursor: default;" width="1920" height="625"></canvas>
            <div id="unity-loading-bar" style="display: none;">
              <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full" style="width: 100%;"></div>
              </div>
            </div>
            <div id="unity-warning"></div>
          </div>
          <script>
            async function mergeUnityWebFiles(baseUrl, filePrefix, totalParts, extension) {
              const partUrls = [];
              for (let i = 1; i <= totalParts; i++) {
                partUrls.push(`${baseUrl}/${filePrefix}_part${i}.${extension}`);
              }
              const buffers = [];
              for (let i = 0; i < totalParts; i++) {
                const response = await fetch(partUrls[i]);
                if (!response.ok) {
                  throw new Error(`Failed to load part: ${partUrls[i]}`);
                }
                const buffer = await response.arrayBuffer();
                buffers.push(buffer);
                const progress = ((i + 1) / totalParts) * 100;
                document.querySelector("#unity-progress-bar-full").style.width = `${progress}%`;
              }
              const totalLength = buffers.reduce((acc, buffer) => acc + buffer.byteLength, 0);
              const combinedBuffer = new Uint8Array(totalLength);
              let offset = 0;
              buffers.forEach((buffer) => {
                combinedBuffer.set(new Uint8Array(buffer), offset);
                offset += buffer.byteLength;
              });
              return combinedBuffer;
            }
            var container = document.querySelector("#unity-container");
            var canvas = document.querySelector("#unity-canvas");
            var loadingBar = document.querySelector("#unity-loading-bar");
            var progressBarFull = document.querySelector("#unity-progress-bar-full");
            var warningBanner = document.querySelector("#unity-warning");
            let myGameInstance = null;
            let isAdShown = false;

            function unityShowBanner(msg, type) {
              function updateBannerVisibility() {
                warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
              }
              var div = document.createElement('div');
              div.innerHTML = msg;
              warningBanner.appendChild(div);
              if (type === 'error') div.style = 'background: red; padding: 10px;';
              else {
                if (type === 'warning') div.style = 'background: yellow; padding: 10px;';
                setTimeout(function() {
                  warningBanner.removeChild(div);
                  updateBannerVisibility();
                }, 5000);
              }
              updateBannerVisibility();
            }

            function showAdOnClick() {
              if (!isAdShown && typeof sdk !== 'undefined' && typeof sdk.showBanner !== 'undefined') {
                sdk.showBanner();
                isAdShown = true;
              }
            }
            var buildUrl = "https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/Build";
            var loaderUrl = buildUrl + "/Granny.loader.js";
            async function initializeGame() {
              try {
                const dataBuffer = await mergeUnityWebFiles(buildUrl, "Granny", 2, "data");
                const wasmBuffer = await mergeUnityWebFiles(buildUrl, "Granny", 2, "wasm");
                const dataBlobUrl = URL.createObjectURL(new Blob([dataBuffer], {
                  type: "application/octet-stream"
                }));
                const wasmBlobUrl = URL.createObjectURL(new Blob([wasmBuffer], {
                  type: "application/octet-stream"
                }));
                var config = {
                  dataUrl: dataBlobUrl,
                  frameworkUrl: buildUrl + "/Granny.framework.js",
                  codeUrl: wasmBlobUrl,
                  streamingAssetsUrl: "https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/StreamingAssets",
                  companyName: "Anastasia Kazantseva",
                  productName: "Granny",
                  productVersion: "1.0",
                  showBanner: unityShowBanner,
                };
                var script = document.createElement("script");
                script.src = loaderUrl;
                script.onload = () => {
                  createUnityInstance(canvas, config, (progress) => {
                    progressBarFull.style.width = 100 * progress + "%";
                  }).then((unityInstance) => {
                    myGameInstance = unityInstance;
                    loadingBar.style.display = "none";
                    document.getElementById('loading-screen').style.display = 'none';
                    removeBloodDroplets();
                    disableJumpscare();
                    canvas.addEventListener('pointerdown', showAdOnClick);
                    canvas.addEventListener('touchstart', showAdOnClick);
                  }).catch((message) => {
                    alert(message);
                  });
                };
                document.body.appendChild(script);
              } catch (error) {
                console.error("Game initialization failed:", error);
              }
            }

            function removeBloodDroplets() {
              const drips = document.querySelectorAll('.drip');
              drips.forEach(drip => drip.remove());
            }
            

            

            initializeGame();
          </script>
        </content>
      </moduleprefs>
    </module>
    <div id="imaContainer" style="position: absolute; z-index: 10000; top: 0px; left: 0px; width: 100%; height: 100%; background-color: rgb(0, 0, 0); visibility: hidden; overflow: hidden;">
      <video id="imaVideo"></video>
    </div>
    <div id="imaContainer_new" style="position: absolute; z-index: 10000; top: 0px; left: 0px; width: 100%; height: 100%; background-color: rgb(0, 0, 0); visibility: hidden; overflow: hidden;">
      <video2 id="imaVideo2"></video2>
    </div>
    <div id="sdk__advertisement" style="position: fixed; z-index: 0; top: 0px; left: 0px; width: 100%; height: 100%; transform: translateX(-9999px); background-color: rgba(0, 0, 0, 0.8); opacity: 0; transition: opacity 300ms cubic-bezier(0.55, 0, 0.1, 1) 0s;">
      <div id="sdk__advertisement_slot" style="position: absolute; background-color: rgb(0, 0, 0); top: 0px; left: 0px; width: 1920px; height: 625px;">
        <div style="position: absolute;">
          <div style="display: none;">
            <video title="Advertisement" webkit-playsinline="true" playsinline="true" style="background-color: rgb(0, 0, 0); height: 100%; width: 100%; position: absolute; left: 0px; top: 0px;"></video>
            <div style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;"></div>
          </div>
          <div style="display: none;">
            <video title="Advertisement" webkit-playsinline="true" playsinline="true" style="background-color: rgb(0, 0, 0); height: 100%; width: 100%; position: absolute; left: 0px; top: 0px;"></video>
            <div style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;"></div>
          </div>
          <iframe src="https://imasdk.googleapis.com/js/core/bridge3.691.0_en.html#fid=goog_211982401" allowfullscreen="" allow="autoplay;attribution-reporting" id="goog_211982401" title="Advertisement" style="border: 0px; opacity: 0; margin: 0px; padding: 0px; position: relative; color-scheme: light;"></iframe>
          <iframe title="Advertisement" style="display: none;"></iframe>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/gh/gru6nny/ohd@main/Build/Granny.loader.js"></script>
    <script src="blob:https://1967564194-atari-embeds.googleusercontent.com/cde0f3b1-9fc1-4693-9e22-9e280c90ed2e"></script>
  </body>
</html>
